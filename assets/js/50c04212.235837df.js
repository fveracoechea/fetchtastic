"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[614],{6652:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>r,default:()=>p,frontMatter:()=>a,metadata:()=>i,toc:()=>c});var s=t(6106),o=t(9252);const a={title:"Usage Guide",sidebar_position:2},r=void 0,i={id:"usage-guide",title:"Usage Guide",description:"Basic example",source:"@site/docs/usage-guide.mdx",sourceDirName:".",slug:"/usage-guide",permalink:"/fetchtastic/docs/usage-guide",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/usage-guide.mdx",tags:[],version:"current",sidebarPosition:2,frontMatter:{title:"Usage Guide",sidebar_position:2},sidebar:"tutorialSidebar",previous:{title:"Getting Started",permalink:"/fetchtastic/docs/getting-started"},next:{title:"Error Handling",permalink:"/fetchtastic/docs/error-handling"}},l={},c=[{value:"Basic example",id:"basic-example",level:2},{value:"Composable configuration",id:"composable-configuration",level:2},{value:"1. Global config",id:"1-global-config",level:3},{value:"2. Endpoint level config",id:"2-endpoint-level-config",level:3},{value:"3. Send Requests",id:"3-send-requests",level:3},{value:"Aborting a request",id:"aborting-a-request",level:2},{value:"Type-safety",id:"type-safety",level:2},{value:"Generic types",id:"generic-types",level:3},{value:"Runtime schema validation",id:"runtime-schema-validation",level:3},{value:"Type guards",id:"type-guards",level:4},{value:"Zod",id:"zod",level:4}];function d(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",h4:"h4",p:"p",pre:"pre",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h2,{id:"basic-example",children:"Basic example"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"const api = new Fetchtastic('https://jsonplaceholder.typicode.com')\n  .setOptions({ cache: 'default', mode: 'cors' })\n  .headers({\n    Accept: 'application/json',\n    'Content-Type': 'application/json',\n  });\n\n// get request\nconst albums = await api\n  .get('/albums')\n  .searchParams({ page: 1, per_page: 12 })\n  .json();\n\n// post request\nawait api.post('/albums', { title: 'My New Album' }).resolve();\n"})}),"\n",(0,s.jsx)(n.h2,{id:"composable-configuration",children:"Composable configuration"}),"\n",(0,s.jsx)(n.p,{children:"You can safely reuse previous instances. All methods return a new instance and\ndoes not modify the previous one."}),"\n",(0,s.jsx)(n.h3,{id:"1-global-config",children:"1. Global config"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"const api = new Fetchtastic('/api/v2')\n  .appendHeader('Accept', 'application/json')\n  .setOptions({ credentials: 'include', mode: 'cors' });\n"})}),"\n",(0,s.jsx)(n.h3,{id:"2-endpoint-level-config",children:"2. Endpoint level config"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"const postsApi = api\n  .url('/post')\n  .searchParams({ sortBy: 'date', order: 'desc' });\n\nconst albumsApi = api\n  .url('/albums')\n  .appendHeader('Content-Type', 'application/json');\n"})}),"\n",(0,s.jsx)(n.h3,{id:"3-send-requests",children:"3. Send Requests"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"const posts = await postsApi.get().json();\n\nconst album = await albumsApi.get('/10').json();\n"})}),"\n",(0,s.jsx)(n.h2,{id:"aborting-a-request",children:"Aborting a request"}),"\n",(0,s.jsxs)(n.p,{children:["Fetch has the ability to abort requests using AbortController and signals under\nthe hood. Compatible with browsers that support\n",(0,s.jsx)(n.a,{href:"https://developer.mozilla.org/en-US/docs/Web/API/AbortController",children:"AbortController"}),".\nOtherwise, you could use a\n",(0,s.jsx)(n.a,{href:"https://www.npmjs.com/package/abortcontroller-polyfill",children:"polyfill"}),"."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"const controller = new AbortController();\nconst api = new Fetchtastic('https://jsonplaceholder.typicode.com');\n\napi\n  .controller(controller)\n  .get('/posts/1/comments')\n  .json()\n  .then(data => storeData(data)) // should never be called\n  .catch((e: Error) => {\n    console.log(e.name); // AbortError\n    console.log(e.message); // The user aborted a request.\n  });\n// Abort it!\ncontroller.abort();\n"})}),"\n",(0,s.jsx)(n.p,{children:"With this pattern you can also associate the same controller with multiple\nrequests:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"const controller = new AbortController();\n\napi.controller(controller).get('/posts').json();\napi.controller(controller).get('/comments').json();\n// Abort both requests\ncontroller.abort();\n"})}),"\n",(0,s.jsx)(n.h2,{id:"type-safety",children:"Type-safety"}),"\n",(0,s.jsxs)(n.p,{children:["By default, the ",(0,s.jsx)(n.code,{children:"json()"})," method returns an ",(0,s.jsx)(n.code,{children:"unknown"})," type, however there are two\nways to infer type-safety for the resulting data types."]}),"\n",(0,s.jsx)(n.h3,{id:"generic-types",children:"Generic types"}),"\n",(0,s.jsxs)(n.p,{children:["By providing a\n",(0,s.jsx)(n.a,{href:"https://www.typescriptlang.org/docs/handbook/2/generics.html",children:"generic"})," type\nargument to ",(0,s.jsx)(n.code,{children:".json()"})," the resulting type will inferred:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"type Post = {\n  id: number;\n  title: string;\n  body: string;\n};\n\nconst request = new Fetchtastic('https://jsonplaceholder.typicode.com');\n\nconst post = await request.get('/posts/3').json<Post>();\n"})}),"\n",(0,s.jsx)(n.h3,{id:"runtime-schema-validation",children:"Runtime schema validation"}),"\n",(0,s.jsxs)(n.p,{children:["You can provide a function to the ",(0,s.jsx)(n.code,{children:"json()"})," resolver that performs runtime\nvalidations in order to assert the returned type. Next are two examples to\nachieve that:"]}),"\n",(0,s.jsx)(n.h4,{id:"type-guards",children:(0,s.jsx)(n.a,{href:"https://www.typescriptlang.org/docs/handbook/2/narrowing.html#using-type-predicates",children:"Type guards"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"type Post = {\n  id: number;\n  title: string;\n  body: string;\n};\n\nfunction isPost(data: unknown): data is Post {\n  return (\n    data != null &&\n    typeof data === 'object' &&\n    'title' in data &&\n    typeof data.title === 'string' &&\n    'body' in data &&\n    typeof data.body === 'string'\n  );\n}\n\nexport function assertIsPost(data: unknown) {\n  if (isPost(data)) return data;\n  else throw new Error('Invalid data');\n}\n\nconst request = new Fetchtastic('https://jsonplaceholder.typicode.com');\n\nconst post = await request.get('/posts/3').json(assertIsPost);\n"})}),"\n",(0,s.jsx)(n.h4,{id:"zod",children:(0,s.jsx)(n.a,{href:"https://zod.dev/",children:"Zod"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import { z } from 'zod';\n\nconst PostSchema = z.object({\n  id: z.number(),\n  title: z.string(),\n  body: z.string(),\n});\n\nconst post = await new Fetchtastic().get('/posts/5').json(PostSchema.parse);\n"})})]})}function p(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},9252:(e,n,t)=>{t.d(n,{R:()=>r,x:()=>i});var s=t(7378);const o={},a=s.createContext(o);function r(e){const n=s.useContext(a);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:r(e.components),s.createElement(a.Provider,{value:n},e.children)}}}]);